(function(){"use strict";var t={4669:function(t,e,a){var s=a(144),o=a(998),i=a(6232),n=a(5550),l=a(9582),r=a(2150),d=a(9223),c=a(4324),m=a(5808),p=a(4525),u=a(8279),_=a(4611),h=a(3059),g=a(2604),f=a(7953),v=function(){var t=this,e=t._self._c;return e(o.Z,{attrs:{id:"inspire"}},[e(l.Z,[e(g.Z,{attrs:{app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e(p.Z,[e(u.km,[e(u.V9,{staticClass:"text-h6"},[t._v(" 推邮系统 ")]),e(u.oZ,[t._v(" "+t._s(t.tySysOwner)+" ")])],1)],1),e(d.Z),e(m.Z,{attrs:{dense:"",nav:""}},t._l(t.items,(function(a){return e(p.Z,{key:a.title,attrs:{link:""}},[e(_.Z,[e(c.Z,{attrs:{color:a.color}},[t._v(t._s(a.icon))])],1),e(u.km,[e(u.V9,{on:{click:function(e){return t.jmpPage(a.kk)}}},[t._v(" "+t._s(a.title))])],1)],1)})),1)],1)],1),e(i.Z,{attrs:{app:""}},[e(n.Z,{on:{click:function(e){t.drawer=!t.drawer}}}),e(f.qW,[t._v(t._s(t.tySysOwner))])],1),e(h.Z,[e(r.Z,{attrs:{fluid:""}},[e("router-view")],1)],1)],1)},x=[],Z=a(9669),y=a.n(Z),b={data:()=>({drawer:null,items:[],tySysOwner:"System admin",logininfo:{}}),created:async function(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)})),this.tySysOwner,this.items=[{title:"域名",icon:"mdi-domain",color:"blue darken-2",kk:"domains"},{title:"邮件列表",icon:"mdi-email",color:"green darken-2",kk:"emails"},{title:"发送记录",icon:"mdi-notebook",color:"green darken-2",kk:"sendlogs"},{title:"设置帮助",icon:"mdi-asterisk",color:"orange darken-2",kk:"setting"}]},methods:{jmpPage:function(t){"domains"==t?this.$router.push({name:"vDomains",params:{msg:t}}):"emails"==t?this.$router.push({name:"vEmails",params:{msg:t}}):"sendlogs"==t?this.$router.push({name:"vSendLogs",params:{msg:t}}):"setting"==t&&this.$router.push({name:"vSetting",params:{msg:t}})}}},S=b,k=a(1001),w=(0,k.Z)(S,v,x,!1,null,null,null),D=w.exports,E=a(1705);s.ZP.use(E.Z);var P=new E.Z({}),F=a(8345),C=function(){var t=this,e=t._self._c;return e("h1",[t._v("Hello "+t._s(t.$route.params.msg))])},R=[],L={name:"vHelloWorld",data:()=>({})},M=L,j=(0,k.Z)(M,C,R,!1,null,null,null),N=j.exports,B=a(6190),T=a(4886),O=a(4127),U=a(266),A=a(4474),K=a(1713),I=a(7808),$=function(){var t=this,e=t._self._c;return e(r.Z,[e("h3",{staticStyle:{"padding-bottom":"20px"}},[t._v("管理你的域名")]),e(K.Z,[e(U.Z,{attrs:{cols:"1"}},[e(B.Z,{attrs:{block:"",color:"primary"},on:{click:function(e){return t.addNewDomain(e)}}},[t._v("新增域名")])],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[e(I.Z,{attrs:{"append-icon":"mdi-magnify",label:"查找","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(A.Z,{attrs:{headers:t.headers,items:t.domains,search:t.search},scopedSlots:t._u([{key:"item.doEdit",fn:function({item:a}){return[e(O.Z,{attrs:{color:"secondary",dark:""},on:{click:function(e){return t.doEdit({item:a})}}},[t._v(" 修改 "+t._s(a.none)+" ")])]}}],null,!0)})],1)],1)],1)],1)},W=[],z={name:"vTyWorkSpace",data:()=>({logininfo:{},search:"",headers:[{text:"域名",value:"domain"},{text:"mx",value:"mx"},{text:"spf",value:"spf"},{text:"dmarc",value:"dmarc"},{text:"ptr",value:"ptr"},{text:"uid",value:"uid"},{text:"收件数量",value:"mailcount"},{text:"编辑",value:"doEdit"}],domains:[{domain:"loading 正在加载"}]}),methods:{addNewDomain(t){console.log(t),this.$router.push({name:"vPageEditDomain",params:{msg:"new"}})},editDomain(t){console.log(t),console.log("go edit domain",t.item.domain),this.$router.push({name:"vPageEditDomain",params:{msg:t.item.domain}})},_helpMxStr(t){console.log(t),t=JSON.parse(t);let e="";for(let a in t)e+=a,e=e+":"+t[a];return e},doEdit:function(t){console.log("doEdit",t),this.editDomain(t)}},mounted:function(){let t=2;1!=t&&(y().defaults.baseURL="",y().get("/api/getDomains").then((t=>{if(console.log("/getDomains",t),this.domains=[],200==t.status&&200==t.data.code){let e=t.data.data;for(let t in e){console.log("item",e[t]);let a={};a.domain=e[t].domain,a.mailcount=e[t].recv_count,a.mx=this._helpMxStr(e[t].dns_mx),this.domains.push(a)}}})).catch((t=>{console.log(t)})))},async created(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}))}},G=z,H=(0,k.Z)(G,$,W,!1,null,null,null),X=H.exports,V=function(){var t=this,e=t._self._c;return e(r.Z,[e("h3",{staticStyle:{"padding-bottom":"20px"}},[t._v("邮件列表")]),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[e(I.Z,{attrs:{"append-icon":"mdi-magnify",label:"查找","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(A.Z,{attrs:{headers:t.headers,items:t.maillist,search:t.search,loading:t.loading,"server-items-length":t.totalCnt,options:t.options,"footer-props":{itemsPerPageOptions:[50,100],"items-per-page-text":"每页展示"}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.from_addr",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)}},[t._v(" "+t._s(a.from_addr)+" ")])]}},{key:"item.to_addr",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)}},[t._v(" "+t._s(a.to_addr)+" ")])]}},{key:"item.subject",fn:function({item:a}){return[e("div",{style:{padding:"3px",cursor:"pointer","font-weight":t.getFontWeight(a)},on:{click:function(e){return t.subjectClick(a)}}},[t._v(" "+t._s(a.subject)+" ")])]}},{key:"item.mail_time",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)},on:{click:function(e){return t.subjectClick(a)}}},[t._v(" "+t._s(a.mail_time)+" ")])]}}],null,!0)})],1)],1)],1)],1)},J=[],Y={name:"vEMailList",data:()=>({logininfo:{},search:"",headers:[{text:"发件人",value:"from_addr",width:18},{text:"收件人",value:"to_addr",width:120},{text:"内容",value:"subject"},{text:"时间",value:"mail_time",width:120}],maillist:[],loading:!0,options:{itemsPerPage:50,page:1},totalCnt:0}),methods:{subjectClick:function(t){console.log("click item",t),console.log("open mail "+t.ref_id),this.$router.push({name:"vEmailContent",params:{mailid:t.ref_id}})},getFontWeight(t){return console.log("item.is_read ",t.is_read,t.subject),1==t.is_read?"normal":"bold"},loadData:async function(){this.loading=!0;let t=this.options.page,e=this.options.itemsPerPage;y().defaults.baseURL="",y().get("/api/emails?page_index="+t+"&page_size="+e).then((t=>{if(console.log("/emails",t),this.maillist=[],200==t.status&&200==t.data.code){let e=t.data.data;this.loading=!1;for(let t in e){let a={};a.from_addr=e[t].from_addr,a.to_addr=e[t].to_addr,a.mail_time=e[t].mail_time,a.subject=e[t].subject,a.ref_id=e[t].ref_id,a.is_read=e[t].is_read,this.maillist.push(a)}this.totalCnt=t.data.total}})).catch((t=>{console.log(t)}))}},created:async function(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}));let t=2;1!=t&&await this.loadData()},watch:{options:{handler(){console.log("options",this.options),console.log("Go to page ",this.options.page),console.log("Go to page size ",this.options.itemsPerPage),this.loadData()},deep:!0}}},q=Y,Q=(0,k.Z)(q,V,J,!1,null,null,null),tt=Q.exports,et=function(){var t=this,e=t._self._c;return e(r.Z,[e("h3",{staticStyle:{"padding-bottom":"20px"}},[t._v("邮件列表")]),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[e(I.Z,{attrs:{"append-icon":"mdi-magnify",label:"查找","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(A.Z,{attrs:{headers:t.headers,items:t.maillist,search:t.search,loading:t.loading,"server-items-length":t.totalCnt,options:t.options,"footer-props":{itemsPerPageOptions:[50,100],"items-per-page-text":"每页展示"}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.from_addr",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)}},[t._v(" "+t._s(a.from_addr)+" ")])]}},{key:"item.to_addr",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)}},[t._v(" "+t._s(a.to_addr)+" ")])]}},{key:"item.subject",fn:function({item:a}){return[e("div",{style:{padding:"3px",cursor:"pointer","font-weight":t.getFontWeight(a)},on:{click:function(e){return t.subjectClick(a)}}},[t._v(" "+t._s(a.subject)+" ")])]}},{key:"item.mail_time",fn:function({item:a}){return[e("div",{style:{"font-weight":t.getFontWeight(a)},on:{click:function(e){return t.subjectClick(a)}}},[t._v(" "+t._s(a.mail_time)+" ")])]}}],null,!0)})],1)],1)],1)],1)},at=[],st={name:"vSendLogs",data:()=>({logininfo:{},search:"",headers:[{text:"发件人",value:"from_addr",width:18},{text:"收件人",value:"to_addr",width:120},{text:"内容",value:"subject"},{text:"时间",value:"mail_time",width:120},{text:"状态码",value:"respond_code",width:120}],maillist:[],loading:!0,options:{itemsPerPage:50,page:1},totalCnt:0}),methods:{subjectClick:function(t){console.log("click item",t),console.log("open mail "+t.ref_id),this.$router.push({name:"vEmailContent",params:{mailid:t.ref_id}})},getFontWeight(t){return console.log("item.is_read ",t.is_read,t.subject),1==t.is_read?"normal":"bold"},loadData:async function(){this.loading=!0;let t=this.options.page,e=this.options.itemsPerPage;y().defaults.baseURL="",y().get("/api/sendinglogs?page_index="+t+"&page_size="+e).then((t=>{if(console.log("/sendinglogs",t),this.maillist=[],200==t.status&&200==t.data.code){let e=t.data.data;this.loading=!1;for(let t in e){let a={};a.from_addr=e[t].from_addr,a.to_addr=e[t].to_addr,a.mail_time=e[t].mail_time,a.subject=e[t].subject,a.respond_code=e[t].respond_code,a.respond_msg=e[t].respond_msg,this.maillist.push(a)}this.totalCnt=t.data.total}})).catch((t=>{console.log(t)}))}},created:async function(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}));let t=2;1!=t&&await this.loadData()},watch:{options:{handler(){console.log("options",this.options),console.log("Go to page ",this.options.page),console.log("Go to page size ",this.options.itemsPerPage),this.loadData()},deep:!0}}},ot=st,it=(0,k.Z)(ot,et,at,!1,null,null,null),nt=it.exports,lt=a(120),rt=a(6072),dt=function(){var t=this,e=t._self._c;return e(r.Z,[e("h3",{staticStyle:{"padding-bottom":"20px"}},[t._v("设置管理")]),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[t._v(" SMTP MX（收件） 服务器状态 ")]),e(T.ZB,[t.is_running()?e("div",{staticStyle:{color:"green","font-weight":"bolder"}},[t._v("运行中 "),e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.smtpStart()}}},[t._v("重新启动")])],1):e("div",{staticStyle:{color:"red","font-weight":"bolder"}},[t._v("未运行 "),e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.smtpStart()}}},[t._v("重新启动")])],1)])],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[t._v(" 用户管理 ")]),e(T.ZB,[e(lt.Z,{attrs:{label:"允许新用户注册"},on:{change:function(e){return t.updateSet()}},model:{value:t.set_allow_register,callback:function(e){t.set_allow_register=e},expression:"set_allow_register"}})],1)],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.genAPK()}}},[t._v("生成全局 API-KEY")])],1),e(T.ZB,[e("div",{staticStyle:{padding:"4px"}},[e("div",[t._v("appId: "),e("strong",[t._v(t._s(t.appId))])]),e("div",[t._v("appSecret: "),e("strong",[t._v(t._s(t.appSecret))])])])])],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12"}},[e(l.Z,[e(T.EB,[t._v(" 请填写私钥和证书信息 并保存  "),e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.savePERM()}}},[t._v("保存TLS key")])],1),e(T.EB,[t._v(" 如果你不会填写，可以尝试    "),e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.genPERM()}}},[t._v("自动生成全局 TLS key")])],1),e(T.ZB,[e(rt.Z,{staticStyle:{"font-family":"monospace"},attrs:{outlined:"",id:"idSetKEY",label:"私钥文件",hint:"私钥文件"},model:{value:t.setKey,callback:function(e){t.setKey=e},expression:"setKey"}}),e(rt.Z,{staticStyle:{"font-family":"monospace"},attrs:{outlined:"",id:"idSetCert",label:"证书信息",hint:"证书信息"},model:{value:t.setCert,callback:function(e){t.setCert=e},expression:"setCert"}})],1)],1)],1)],1)],1)},ct=[],mt={name:"vTyWorkSpace",data:()=>({logininfo:{},allow_register:!1,set_smtp_info:{},set_extra:{},appId:"",appSecret:"",setKey:"",setCert:"",setSaveMsg:""}),methods:{loadSetting:function(){y().defaults.baseURL="",y().get("/api/setFetch").then((t=>{console.log("fecthSET",t),200==t.status&&200==t.data.code&&(this.set_extra=t.data.data,this.appId=this.set_extra["appId"],this.appSecret=this.set_extra["appSecret"],this.setCert=this.set_extra["setCert"],this.setKey=this.set_extra["setKey"],console.log("sssss 1 =>",this.set_extra))})).catch((t=>{console.log("fecthSET ERR",t)}))},is_running:function(){return console.log("Info",this.set_smtp_info),this.set_smtp_info.start_ctime>0},updateSet:function(){console.log("update set",this.set_extra);let t={headers:{"Content-Type":"application/json"}},e=JSON.stringify(this.set_extra);y().defaults.baseURL="",y().post("/api/setUpdate",e,t).then((t=>{console.log("res==>",t),200==t.status&&200==t.data.code&&(this.set_extra=t.data.data,console.log("sssss",this.set_extra))})).catch((t=>{console.log("err==>",t)}))},smtpStart:function(){y().defaults.baseURL="",y().get("/api/restartCSmtp").then((t=>{if(console.log(t),200==t.status&&200==t.data.code)this.set_smtp_info=t.data.data;else{}})).catch((t=>{console.log("play task",t)}))},genAPK:function(){y().defaults.baseURL="",y().get("/api/getGlobalAppIDnSecret").then((t=>{if(console.log(t),200==t.status&&200==t.data.code)this.appId=t.data.data.appId,this.appSecret=t.data.data.appSecret;else{}})).catch((t=>{console.log("play task",t)}))},genPERM:function(){y().defaults.baseURL="",y().get("/api/getGlobalPERM").then((t=>{if(console.log("genPERM",t),200==t.status&&200==t.data.code)this.setKey=t.data.data.setKey,this.setCert=t.data.data.setCert,this.setSaveMsg="生成成功";else{this.setSaveMsg=t.data.message}})).catch((t=>{console.log("play genPERM execept ",t)}))},savePERM:function(){y().defaults.baseURL="";let t={cert:this.setCert,key:this.setKey};y().post("/api/saveGlobalPERM",t).then((t=>{if(console.log("save Cert ",t),200==t.status&&200==t.data.code)this.setKey=t.data.data.setKey,this.setCert=t.data.data.setCert,this.setSaveMsg="保存成功";else{this.setSaveMsg=t.data.message}})).catch((t=>{console.log("play savePERM execept ",t)}))}},mounted:function(){let t=2;1!=t&&(this.loadSetting(),y().defaults.baseURL="",y().get("/api/getCSmtp").then((t=>{if(console.log(t),200==t.status&&200==t.data.code)this.set_smtp_info=t.data.data;else{}})).catch((t=>{console.log(t)})))},computed:{set_allow_register:{get(){return 1==this.set_extra["allow_register"]},set(t){return this.set_extra["allow_register"]=t,t}}},async created(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}))}},pt=mt,ut=(0,k.Z)(pt,dt,ct,!1,null,null,null),_t=ut.exports,ht=a(7359),gt=function(){var t=this,e=t._self._c;return e(r.Z,[e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"6"}},[e("h1",{staticStyle:{"padding-bottom":"20px"}},[t._v("域名设置 "+t._s(t.$route.params.msg)+" ")])]),t._v(" "),e(U.Z,{attrs:{cols:"12",sm:"6"}},[e("a",{staticStyle:{"vertical-align":"bottom"},attrs:{href:"/dash/domains"}},[t._v(" 返回域名列表 ")])])],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"6"}},[t._v(" 域名 "),e(I.Z,{attrs:{placeholder:"输入域名"},on:{keyup:t.makeDns,blur:t.makeDns},model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})],1),e(U.Z,{attrs:{cols:"12",sm:"6"}},[t._v(" 主收信IP "),e(I.Z,{attrs:{placeholder:"点击自动获取本机IP"},on:{keyup:t.makeDns,blur:t.makeDns,click:function(e){return t.loadServerIp(e)}},model:{value:t.ip,callback:function(e){t.ip=e},expression:"ip"}})],1)],1),e(K.Z,[e(U.Z,[e("h2",[t._v("收信mx设置")])])],1),e(K.Z,[e(U.Z,[e("div",{staticStyle:{"padding-bottom":"4px"}},[t._v("根据下面的指引，设置dns mx记录")]),e(l.Z,[e(T.EB,[t._v(" 域名: "),e("strong",[t._v(t._s(t.domain))])]),e(T.ZB,[e("div",[t._v("DNS记录类型: "),e("strong",[t._v(" MX ")])]),e("div",[t._v("DNS记录内容: "),e("strong",[t._v(t._s(t.dns_mx))])]),e("div",[t._v("优先级: "),e("strong",[t._v(t._s(10))])])]),e(T.EB,[t._v(" 域名:  "),e("strong",[t._v(t._s(t.dns_a))])]),e(T.ZB,[e("div",[t._v("DNS记录类型: "),e("strong",[t._v(" A ")])]),e("div",[t._v("DNS记录内容:   "),e("strong",[t._v(t._s(t.ip))])])]),e(T.ZB)],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"3"}},[e(B.Z,{attrs:{size:"30",loading:t.mbStatus.isLoading,disabled:t.mbStatus.isDisabled,block:"",color:"primary"},on:{click:function(e){return t.checkDNS(e,"mx")}}},[t._v("验证DNS MX记录")])],1),e(U.Z,{attrs:{cols:"12",sm:"9"}},[e(ht.Z,{directives:[{name:"show",rawName:"v-show",value:t.dns_mx_alert.show,expression:"dns_mx_alert.show"}],attrs:{text:"",dense:"",type:t.dns_mx_alert.type}},[t._v(" "+t._s(t.dns_mx_alert.message))])],1)],1),e(K.Z,[e(U.Z,[e("h2",[t._v("发信设置")])])],1),e(K.Z,[e(U.Z,[e("h3",[t._v("1. SPF设置")])])],1),e(K.Z,[e(U.Z,[e("div",{staticStyle:{"padding-bottom":"4px"}},[t._v("根据下面的例子，设置dns SPF记录")]),e(l.Z,[e(T.EB,[t._v(" 域名: "),e("strong",[t._v(t._s(t.domain))])]),e(T.ZB,[e("div",[t._v("DNS记录类型: "),e("strong",[t._v(" TXT ")])]),e("div",[t._v("DNS记录内容: "),e("strong",[t._v(" v=spf1 a mx ip4:"+t._s(t.ip)+" ip4:"+t._s(t.ip)+" -all ")])]),t._v(" (ip4发信ip，上面仅仅是举例，需要根据你的发信出口ip修改) ")])],1)],1)],1),e(K.Z,[e(U.Z,[e("h3",[t._v("2. DMARC设置")])])],1),e(K.Z,[e(U.Z,[e("h4",[t._v("填写default.txt文件")])])],1),e(K.Z,[e(U.Z,[e("div",[t._v(" 运行 "),e("div",{staticStyle:{"background-color":"#FFFFE0",padding:"8px"}},[t._v("opendkim-genkey -d "+t._s(t.domain)+" -s "+t._s(t.dmarc_selector)+" ")])]),e("div",[t._v("当前目录，找到default.txt ，将文件内容粘贴到下面。或者你可点击下面按钮自动获取DKIM信息")])])],1),e(K.Z,[e(U.Z,[e(B.Z,{attrs:{"x-small":""},on:{click:function(e){return t.getDKIM()}}},[t._v("自动获取DKIM")])],1)],1),e(K.Z,[e(U.Z,[e(rt.Z,{staticStyle:{"font-family":"monospace"},attrs:{outlined:"",id:"idmarc_txt",label:"default.txt文件内容",hint:"dkim key"},on:{change:t.syncDMarc},model:{value:t.dmarc_txt,callback:function(e){t.dmarc_txt=e},expression:"dmarc_txt"}})],1)],1),e(K.Z,[e(U.Z,[e("h4",[t._v("填写default.private文件")])])],1),e(K.Z,[e(U.Z,[e("div",[t._v("运行上面命令后，在当前目录找到default.private ，将文件内容粘贴到下面")])])],1),e(K.Z,[e(U.Z,[e(rt.Z,{staticStyle:{"font-family":"monospace"},attrs:{outlined:"",id:"idmarc_private",label:"default.private文件内容",hint:"dkim private key"},model:{value:t.dmarc_key,callback:function(e){t.dmarc_key=e},expression:"dmarc_key"}})],1)],1),e(K.Z,[e(U.Z,[e("div",{staticStyle:{"padding-bottom":"4px"}},[t._v("根据下面的提示，设置dns DMarc记录")]),e(l.Z,[e(T.EB,[t._v(" 域名: "),e("strong",[t._v(t._s(t.dmarc_selector)+"._domainkey."+t._s(t.domain))])]),e(T.ZB,[e("div",[t._v("DNS记录类型: "),e("strong",[t._v(" TXT ")])]),e("div",[t._v("DNS记录内容: ")]),e("div",[t._v(t._s(t.dns_dmarc))])])],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"3"}},[e(B.Z,{attrs:{size:"30",loading:t.dmarc_Status.isLoading,disabled:t.dmarc_Status.isDisabled,block:"",color:"primary"},on:{click:function(e){return t.checkDNSDmarc(e,"dmarc")}}},[t._v("验证DNS DMARC记录")])],1),e(U.Z,{attrs:{cols:"12",sm:"9"}},[e(ht.Z,{directives:[{name:"show",rawName:"v-show",value:t.dmarc_alert.show,expression:"dmarc_alert.show"}],attrs:{text:"",dense:"",type:t.dmarc_alert.type}},[t._v(" "+t._s(t.dmarc_alert.message))])],1)],1),e(K.Z,[e(U.Z,[e("h3",[t._v("3. 发信节点设置")])])],1),e(K.Z,[e(U.Z,[e(I.Z,{attrs:{label:"发信限制",clearable:""},model:{value:t.extrForm_rule_limit,callback:function(e){t.extrForm_rule_limit=e},expression:"extrForm_rule_limit"}})],1)],1),e(K.Z,[e(U.Z,[e(I.Z,{attrs:{label:"发信密码",clearable:""},model:{value:t.extrForm_rule_pwd,callback:function(e){t.extrForm_rule_pwd=e},expression:"extrForm_rule_pwd"}})],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"3"}},[e(B.Z,{attrs:{block:""},on:{click:function(e){return t.genAppidSecret()}}},[t._v("生成appid/appsecret")])],1)],1),e(K.Z,[e(U.Z,[e(I.Z,{attrs:{label:"appid",clearable:""},model:{value:t.extrForm_appid,callback:function(e){t.extrForm_appid=e},expression:"extrForm_appid"}})],1)],1),e(K.Z,[e(U.Z,[e(I.Z,{attrs:{label:"appsecret",clearable:""},model:{value:t.extrForm_appsecret,callback:function(e){t.extrForm_appsecret=e},expression:"extrForm_appsecret"}})],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"3"}},[e(B.Z,{attrs:{size:"20",block:"",color:"primary"},on:{click:function(e){return t.saveExtra()}}},[t._v("保存发信节点设置")])],1),e(U.Z,{attrs:{cols:"12",sm:"9"}},[e(ht.Z,{directives:[{name:"show",rawName:"v-show",value:t.extra_alert.show,expression:"extra_alert.show"}],attrs:{text:"",dense:"",type:t.extra_alert.type}},[t._v(" "+t._s(t.extra_alert.message))])],1)],1),e(K.Z,[e(U.Z,[e("h3",[t._v("4. 发信节点配置文件")])])],1),e(K.Z,[e(U.Z,[e("div",{staticStyle:{"padding-bottom":"4px"}},[t._v("复制 "),e("strong",[t._v(" "+t._s(this.domain)+" ")]),t._v("单域名配置文件到节点，再重启节点docker")]),e(l.Z,[e(rt.Z,{staticStyle:{"font-family":"monospace"},attrs:{outlined:"",id:"idenvcfg",label:"配置文件.conf",hint:"配置文件"},model:{value:t.envConf,callback:function(e){t.envConf=e},expression:"envConf"}})],1)],1)],1),e(K.Z,[e(U.Z,{attrs:{cols:"12",sm:"3"}},[e(B.Z,{attrs:{size:"20",block:"",color:"primary"},on:{click:function(e){return t.genConfigText()}}},[t._v("生成发信节点配置文件")])],1),e(U.Z,{attrs:{cols:"12",sm:"9"}},[e(ht.Z,{directives:[{name:"show",rawName:"v-show",value:t.configText_alert.show,expression:"configText_alert.show"}],attrs:{text:"",dense:"",type:t.configText_alert.type}},[t._v(" "+t._s(t.configText_alert.message))])],1)],1)],1)},ft=[],vt={name:"vDomainAcc",data:()=>({loading_fail:!0,logininfo:{},domain:"",dns_mx:"",dns_a:"",ip:"",dns_dmarc:"",dmarc_key:"",dmarc_txt:"",js_status_loading:!1,mbStatus:{isLoading:!1,isDisabled:!1},dns_mx_alert:{type:"info",show:!1,message:""},dmarc_Status:{isLoading:!1,isDisabled:!1},dmarc_alert:{type:"info",show:!1,message:""},dmarc_selector:"default",xrefid:(Math.random()+(new Date).getTime()).toString(32).slice(0,8),extrForm_rule_limit:"",extrForm_rule_pwd:"",extrForm_appid:"",extrForm_appsecret:"",extra_alert:{type:"info",show:!1,message:""},envConf:"",configText_alert:{type:"info",show:!1,message:""}}),methods:{resetStatus:function(){this.js_status_loading=!1,this.dns_mx_alert={type:"info",show:!1,message:""}},makeDns:function(){console.log("domainis ",this.domain),this.dns_mx="mx1."+this.domain+".",this.dns_a="mx1."+this.domain,console.log("BASE URL "+this.cfgset),this.resetStatus()},checkDNS:function(t,e){this.mbStatus.isLoading=!0,this.mbStatus.isDisabled=!0,console.log("event.target",t.target),console.log("check DNS for ",this.domain,this.ip),y().defaults.baseURL="",y().post("/api/checkDNS",{domain:this.domain,type:e,extra:this.dns_a,content:this.ip,xrefid:this.xrefid}).then((t=>{console.log("checkDNS OK, resp ",t),200==t.status&&(200==t.data.code&&"OK"==t.data.message?(this.dns_mx_alert.message="设置成功",this.dns_mx_alert.type="success"):(this.dns_mx_alert.message="设置失败，请检查dns的mx记录",this.dns_mx_alert.type="warning"),this.dns_mx_alert.show=!0,this.mbStatus.isLoading=!1,this.mbStatus.isDisabled=!1)})).catch((t=>{console.log("checkDNS ERROR",t),this.mbStatus.isLoading=!1,this.mbStatus.isDisabled=!1}))},checkDNSDmarc:function(t,e){this.dmarc_Status.isLoading=!0,this.dmarc_Status.isDisabled=!0,console.log("event.target",t.target),console.log("check DNS for ",this.domain,this.ip),y().defaults.baseURL="",y().post("/api/checkDNS",{domain:this.domain,type:e,extra:this.dns_dmarc,selector:this.dmarc_selector,dmarc_key:this.dmarc_key,content:this.dmarc_txt,xrefid:this.xrefid}).then((t=>{console.log("checkDNS OK, resp ",t),200==t.status&&(200==t.data.code&&"OK"==t.data.message?(this.dmarc_alert.message="设置成功",this.dmarc_alert.type="success"):(this.dmarc_alert.message="设置失败，请检查域名"+this.dmarc_selector+"._domainkey."+this.domain+"的 TXT 记录",this.dmarc_alert.type="warning"),this.dmarc_alert.show=!0,this.dmarc_Status.isLoading=!1,this.dmarc_Status.isDisabled=!1)})).catch((t=>{console.log("checkDNS ERROR",t),this.dmarc_Status.isLoading=!1,this.dmarc_Status.isDisabled=!1}))},syncDMarc:function(){let t=document.getElementById("idmarc_txt").value;console.log("MyCdata",t);let e=t.match(/(\S+)\s+(\S+)\s+(\S+)\s+\(([^)]+)\)/),a=e[4];console.log("dmarcRaw",a),"undefined"==typeof String.prototype.replaceAll3&&(console.log("add New replaceAll3"),String.prototype.replaceAll3=function(t,e){return this.replace(new RegExp(t,"gm"),e)});let s=a.replaceAll3(" ","");s=s.replaceAll3("\n",""),s=s.replaceAll3('"',""),s=s.replaceAll3(";","; "),console.log("nd",s),this.dns_dmarc=s},loadServerIp:function(t){if(this.resetStatus(),this.js_status_loading)return;if(this.ip.length>5)return;let e=t.target;e.setAttribute("placeholder","正在加载本机ip..."),y().defaults.baseURL="",y().get("/api/getHostIp").then((t=>{console.log("loadMyIp ",t),200==t.status&&200==t.data.code&&(this.ip=t.data.data),this.js_status_loading=!1,e.setAttribute("placeholder",""),this.makeDns()})).catch((t=>{console.log("error on loadServerIp",t),this.js_status_loading=!1,e.setAttribute("placeholder","")}))},doPopuData:function(t){if(console.log("doPopuData ",t),200==t.status&&200==t.data.code){this.loading_fail=!1;let e=t.data.data;if(0==e.length)return;this.domain=e[0].domain;const a=JSON.parse(e[0].dns_mx),s=Object.keys(a)[0];this.dns_mx=s,this.dns_a=s,this.ip=a[s],this.dmarc_txt=e[0].dmarc_txt,this.dmarc_key=e[0].dmarc_key,this.dns_dmarc=e[0].dns_dmarc,this.extrForm_rule_limit=e[0].rule_limit,this.extrForm_rule_pwd=e[0].rule_pwd,this.extrForm_appid=e[0].appid,this.extrForm_appsecret=e[0].appsecret}else this.loading_fail=!0},getDKIM:function(){if(console.log("getDkim run for domian "+this.domain),this.domain.length<3)return;y().defaults.baseURL="";let t={domain:this.domain};y().post("/api/getDkimPT",t).then((t=>{if(console.log("response->",t),200==t.status&&200==t.data.code){let e=t.data;this.dmarc_txt=e.data.text,this.dmarc_key=e.data.private;let a=this;a.$nextTick((function(){a.syncDMarc()}))}})).catch((t=>{console.log("error=>",t)}))},randomStr:function(t){t=t||32;var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=e.length,s="";for(let o=0;o<t;o++)s+=e.charAt(Math.floor(Math.random()*a));return s},genAppidSecret:function(){let t=this.randomStr(8),e=this.randomStr(32);this.extrForm_appid=t,this.extrForm_appsecret=e},saveExtra:function(){let t={domain:this.domain,appid:this.extrForm_appid,appsecret:this.extrForm_appsecret,rule_limit:this.extrForm_rule_limit,rule_pwd:this.extrForm_rule_pwd,xrefid:this.xrefid};y().defaults.baseURL="",y().post("/api/updateDomainExtra",t).then((t=>{console.log("saveExtra - resp =>",t),200==t.data.code&&"OK"==t.data.message?(this.extra_alert.message="设置成功",this.extra_alert.type="success",t.data.appid&&(this.extrForm_appid=t.data.appid),t.data.appsecret&&(this.extrForm_appsecret=t.data.appsecret),t.data.rule_pwd&&(this.extrForm_rule_pwd=t.data.rule_pwd),t.data.rule_limit&&(this.extrForm_rule_limit=t.data.rule_limit),this.genEConfig()):(this.extra_alert.message="设置失败",this.extra_alert.type="warning"),this.dmarc_alert.show=!0})).catch((t=>{console.log("saveExtra - error =>",t)}))},genEConfig:function(){console.log("gen with pwd ",this.extrForm_rule_pwd),console.log("gen with appid ",this.extrForm_appid),console.log("gen with appsecret ",this.extrForm_appsecret)},genConfigText:function(){if(this.extrForm_appid){alert("genConfText");let t=new URL(window.location.href),e=`[general]\nurl=${t.origin}/api/getNodeConf\nappid=${this.extrForm_appid}\nappsecret=${this.extrForm_appsecret}`;this.envConf=e}}},async created(){console.log("The vue created."),y().defaults.baseURL="",await y().get("/api/profile").then((t=>{if(console.log("profile ",t),200==t.status&&200==t.data.code){console.log("ok"),this.logininfo=t.data.data;const e=this.$route.params.msg;"new"!=e&&(console.log("get this",e),y().get("/api/getDomainByName?domain="+e).then((t=>{this.doPopuData(t),this.genEConfig()})).catch((t=>{console.log("load domain error "+e,t)})))}else window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}))}},xt=vt,Zt=(0,k.Z)(xt,gt,ft,!1,null,null,null),yt=Zt.exports,bt=function(){var t=this,e=t._self._c;return e(r.Z,[e(l.Z,{attrs:{dense:""}},[e(K.Z,[e(U.Z,{staticStyle:{padding:"0px","padding-left":"18px","padding-top":"4px"}},[e("div",{staticStyle:{align:"center",cursor:"pointer",padding:"2px"},on:{click:this.toMailList}},[e(c.Z,[t._v("mdi-account")]),t._v("关闭")],1)])],1),e(K.Z,[e(U.Z,{staticStyle:{padding:"8px"},attrs:{clos:"12"}},[e(T.ZB,{staticStyle:{padding:"4px","padding-left":"12px","font-weight":"bold"}},[t._v(t._s(this.subject))])],1)],1),e(K.Z,[e(U.Z,{staticStyle:{padding:"8px"},attrs:{clos:"6"}},[e(T.ZB,{staticStyle:{padding:"4px","padding-left":"12px"}},[e("strong",[t._v(t._s(this.from_name))]),t._v(" <"+t._s(this.from_addr)+">")]),t._v(" "),e(T.ZB,{staticStyle:{padding:"4px","padding-left":"12px"}},[t._v("发送到 "+t._s(this.to_addr))])],1),e(U.Z,{staticStyle:{padding:"8px","padding-right":"20px"},attrs:{clos:"6"}},[e(T.ZB,{staticStyle:{padding:"4px","text-align":"right"}},[t._v(t._s(this.mail_time))])],1)],1),e(K.Z,[e(U.Z,{staticStyle:{padding:"8px"},attrs:{clos:"12"}},[e("div",{staticStyle:{padding:"8px"},domProps:{innerHTML:t._s(t.body)}})])],1),e(T.ZB,[t._v(" id: "+t._s(this.ref_id))]),e(T.ZB,{on:{click:this.toMailList}},[t._v(" 回退 ")])],1)],1)},St=[],kt={name:"vMailContent",data:()=>({logininfo:{},from_name:"",from_addr:"",to_addr:"",subject:"",mail_time:"",ref_id:"",body:""}),methods:{toMailList:function(){this.$router.push({name:"vEmails",params:{msg:"emails"}})}},mounted:function(){let t=2;1!=t&&(y().defaults.baseURL="",y().get("/api/getmail?mailid="+this.$route.params.mailid).then((t=>{console.log("/getmail",t);let e=t.data.data;this.subject=e.subject,this.from_addr=e.from_addr,this.to_addr=e.to_addr,this.mail_time=e.mail_time,this.body=e.body,this.from_name=e.from_name,this.ref_id=e.ref_id})).catch((t=>{console.log(t)})))},async created(){y().defaults.baseURL="",await y().get("/api/profile").then((t=>{console.log("profile ",t),200==t.status&&200==t.data.code?(console.log("ok"),this.logininfo=t.data.data):window.location="/login"})).catch((t=>{window.location="/login",console.log(t)}))}},wt=kt,Dt=(0,k.Z)(wt,bt,St,!1,null,null,null),Et=Dt.exports;const Pt=F.Z.prototype.push;F.Z.prototype.push=function(t){return Pt.call(this,t).catch((t=>t))};var Ft=new F.Z({mode:"history",routes:[{path:"/",name:"vHome",component:X},{path:"/hello/:msg",name:"vPageHello",component:N},{path:"/dash/:msg",name:"vDomains",component:X},{path:"/email/:msg",name:"vEmails",component:tt},{path:"/sendlogs/:msg",name:"vSendLogs",component:nt},{path:"/setting/:msg",name:"vSetting",component:_t},{path:"/mailcontent/:mailid",name:"vEmailContent",component:Et},{path:"/editdomain/:msg",name:"vPageEditDomain",component:yt}]});s.ZP.use(F.Z),s.ZP.config.productionTip=!1,console.log("I use VUE_APP_BASEURL sx ",{NODE_ENV:"production",VUE_APP_BASEURL:"",BASE_URL:"/"}),new s.ZP({vuetify:P,router:Ft,render:t=>t(D)}).$mount("#app")}},e={};function a(s){var o=e[s];if(void 0!==o)return o.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,a),i.exports}a.m=t,function(){var t=[];a.O=function(e,s,o,i){if(!s){var n=1/0;for(c=0;c<t.length;c++){s=t[c][0],o=t[c][1],i=t[c][2];for(var l=!0,r=0;r<s.length;r++)(!1&i||n>=i)&&Object.keys(a.O).every((function(t){return a.O[t](s[r])}))?s.splice(r--,1):(l=!1,i<n&&(n=i));if(l){t.splice(c--,1);var d=o();void 0!==d&&(e=d)}}return e}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[s,o,i]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var o,i,n=s[0],l=s[1],r=s[2],d=0;if(n.some((function(e){return 0!==t[e]}))){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(r)var c=r(a)}for(e&&e(s);d<n.length;d++)i=n[d],a.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return a.O(c)},s=self["webpackChunkvuetify_app"]=self["webpackChunkvuetify_app"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(4669)}));s=a.O(s)})();
//# sourceMappingURL=app.133b828f.js.map